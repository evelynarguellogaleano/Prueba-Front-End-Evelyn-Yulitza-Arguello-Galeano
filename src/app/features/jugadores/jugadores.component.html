<div class="jugadores-container fade-in">
    <div class="header-actions">
        <h1>Listado de Jugadores</h1>
        <button *ngIf="!formVisible" (click)="mostrarFormulario()" class="btn-primary">
            + Agregar Registro
        </button>
    </div>

    <div *ngIf="formVisible" class="form-section fade-in">
        <h2>{{ editando ? 'Editar Jugador' : 'Nuevo Jugador' }}</h2>

        <div class="error-banner" *ngIf="errorSubmit">{{ errorSubmit }}</div>

        <form [formGroup]="jugadorForm" (ngSubmit)="guardar()" class="modern-form">

            <div class="form-grid">
                <div class="form-group">
                    <label>C√≥digo *</label>
                    <input formControlName="codigo" placeholder="Ej: A123" type="text"
                        [class.error]="jugadorForm.get('codigo')?.invalid && (jugadorForm.get('codigo')?.dirty || jugadorForm.get('codigo')?.touched)"
                        [class.success]="jugadorForm.get('codigo')?.valid && jugadorForm.get('codigo')?.dirty">

                    <div class="error-msg"
                        *ngIf="jugadorForm.get('codigo')?.invalid && (jugadorForm.get('codigo')?.dirty || jugadorForm.get('codigo')?.touched)">
                        <span *ngIf="jugadorForm.get('codigo')?.hasError('required')">Campo requerido</span>
                        <span *ngIf="jugadorForm.get('codigo')?.hasError('maxlength')">M√°ximo 10 caracteres</span>
                        <span *ngIf="jugadorForm.get('codigo')?.hasError('invalidFormat')">Solo may√∫sculas y n√∫meros
                            (sin espacios)</span>
                        <span *ngIf="jugadorForm.get('codigo')?.hasError('noAlfanumerico')">Debe contener al menos una
                            letra y un n√∫mero</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nombres *</label>
                    <input formControlName="nombres" placeholder="Nombre completo"
                        [class.error]="jugadorForm.get('nombres')?.invalid && (jugadorForm.get('nombres')?.dirty || jugadorForm.get('nombres')?.touched)"
                        [class.success]="jugadorForm.get('nombres')?.valid && jugadorForm.get('nombres')?.dirty">

                    <div class="error-msg"
                        *ngIf="jugadorForm.get('nombres')?.invalid && (jugadorForm.get('nombres')?.dirty || jugadorForm.get('nombres')?.touched)">
                        <span *ngIf="jugadorForm.get('nombres')?.hasError('required')"> Campo requerido</span>
                        <span *ngIf="jugadorForm.get('nombres')?.hasError('maxlength')"> M√°ximo 100 caracteres</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Equipo *</label>
                    <select formControlName="equipo"
                        [class.error]="jugadorForm.get('equipo')?.invalid && (jugadorForm.get('equipo')?.dirty || jugadorForm.get('equipo')?.touched)"
                        [class.success]="jugadorForm.get('equipo')?.valid && jugadorForm.get('equipo')?.dirty">
                        <option value="" disabled>Seleccione Equipo</option>
                        <option *ngFor="let eq of equipos" [value]="eq">{{ eq }}</option>
                    </select>

                    <div class="error-msg"
                        *ngIf="jugadorForm.get('equipo')?.invalid && (jugadorForm.get('equipo')?.dirty || jugadorForm.get('equipo')?.touched)">
                        <span> Debe seleccionar un equipo</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Camiseta</label>
                    <input formControlName="camiseta" placeholder="Ej: 10" type="text"
                        [class.error]="jugadorForm.get('camiseta')?.invalid && (jugadorForm.get('camiseta')?.dirty || jugadorForm.get('camiseta')?.touched)"
                        [class.success]="jugadorForm.get('camiseta')?.valid && jugadorForm.get('camiseta')?.dirty">

                    <div class="error-msg"
                        *ngIf="jugadorForm.get('camiseta')?.invalid && (jugadorForm.get('camiseta')?.dirty || jugadorForm.get('camiseta')?.touched)">
                        <span *ngIf="jugadorForm.get('camiseta')?.hasError('soloNumeros')"> Solo se permiten
                            n√∫meros</span>
                        <span *ngIf="jugadorForm.get('camiseta')?.hasError('maxlength')"> M√°ximo 2 caracteres</span>
                    </div>
                </div>

                <div class="form-group" *ngIf="mostrarCampeonatos">
                    <label>Campeonatos *</label>
                    <input formControlName="campeonatos" placeholder="Max 3 car." maxlength="3" type="text"
                        [class.error]="jugadorForm.get('campeonatos')?.invalid && (jugadorForm.get('campeonatos')?.dirty || jugadorForm.get('campeonatos')?.touched)"
                        [class.success]="jugadorForm.get('campeonatos')?.valid && jugadorForm.get('campeonatos')?.dirty">

                    <div class="error-msg"
                        *ngIf="jugadorForm.get('campeonatos')?.invalid && (jugadorForm.get('campeonatos')?.dirty || jugadorForm.get('campeonatos')?.touched)">
                        <span *ngIf="jugadorForm.get('campeonatos')?.hasError('required')"> Requerido para equipos 'A'
                            o 'B'</span>
                        <span *ngIf="jugadorForm.get('campeonatos')?.hasError('soloNumeros')"> Solo se permiten
                            n√∫meros</span>
                        <span *ngIf="jugadorForm.get('campeonatos')?.hasError('maxlength')"> M√°ximo 3
                            caracteres</span>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" (click)="cancelar()" class="btn-secondary">Cancelar</button>
                <button type="submit" class="btn-primary" [disabled]="jugadorForm.invalid">Guardar</button>
            </div>
        </form>
    </div>

    <div class="table-section">
        <table class="modern-table">
            <thead>
                <tr>
                    <th>C√≥digo</th>
                    <th>Nombre</th>
                    <th>Equipo</th>
                    <th>Camiseta</th>
                    <th>Campeonatos</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let j of jugadores$ | async">
                    <td>{{ j.codigo }}</td>
                    <td>{{ j.nombres }}</td>
                    <td>{{ j.equipo }}</td>
                    <td>{{ j.camiseta || '-' }}</td>
                    <td>{{ j.campeonatos || '-' }}</td>
                    <td>
                        <button (click)="cargarJugador(j)" class="btn-icon edit" title="Editar">‚úé</button>
                        <button (click)="eliminar(j.codigo)" class="btn-icon delete" title="Eliminar">üóë</button>
                    </td>
                </tr>
                <tr *ngIf="(jugadores$ | async)?.length === 0">
                    <td colspan="6" class="empty-state">No hay jugadores registrados.</td>
                </tr>
            </tbody>
        </table>
    </div>


    <div *ngIf="modalEliminarVisible" class="modal-overlay" (click)="cerrarModalEliminar()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-icon"></span>
                <h3>Confirmar Eliminaci√≥n</h3>
            </div>
            <div class="modal-body">
                <p>¬øEst√° seguro de que desea eliminar este jugador?</p>
                <p class="modal-warning">Esta acci√≥n no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button (click)="cerrarModalEliminar()" class="btn-modal-cancel">Cancelar</button>
                <button (click)="confirmarEliminacion()" class="btn-modal-confirm">Eliminar</button>
            </div>
        </div>
    </div>
</div>